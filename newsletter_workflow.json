{
  "name": "ì„¸ë¯¸ë‚˜ ë°ëª¨ ìš© ì›Œí¬í”Œë¡œìš°",
  "nodes": [
    {
      "parameters": {
        "path": "research",
        "responseMode": "lastNode",
        "options": {
          "responsePropertyName": "data"
        }
      },
      "id": "f56d9bad-15c7-4108-8f9e-9da72441771f",
      "name": "Webhook íŠ¸ë¦¬ê±°",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        -1400,
        180
      ],
      "webhookId": "research-webhook"
    },
    {
      "parameters": {
        "url": "https://openapi.naver.com/v1/search/news.json",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "query",
              "value": "={{ $json.query }}"
            },
            {
              "name": "display",
              "value": "20"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-Naver-Client-Id",
              "value": "=ukBNYmnsfjlX82JImWyp"
            },
            {
              "name": "X-Naver-Client-Secret",
              "value": "Nz6VHqzBjR"
            }
          ]
        },
        "options": {
          "timeout": 10000
        }
      },
      "id": "954c9fb7-a25b-42d6-8018-ca679663a5aa",
      "name": "ë„¤ì´ë²„ ë‰´ìŠ¤ ê²€ìƒ‰ (Naver API)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [
        -1100,
        180
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://openapi.naver.com/v1/datalab/search",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {}
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-Naver-Client-Id",
              "value": "=ukBNYmnsfjlX82JImWyp"
            },
            {
              "name": "X-Naver-Client-Secret",
              "value": "Nz6VHqzBjR"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{ \"startDate\":\"2025-01-01\", \n  \"endDate\":\"2025-07-27\", \n  \"timeUnit\":\"month\", \n  \"keywordGroups\":[   \n    { \"groupName\":\"AI\",\n      \"keywords\":[\"ì±—GPT\",\"ìƒì„±í˜•AI\"] \n    },   \n    { \"groupName\":\"í´ë¼ìš°ë“œ\", \n      \"keywords\":[\"AWS\",\"Azure\"] } \n  ], \n  \"device\":\"pc\", \n  \"ages\":[\"3\",\"4\",\"5\"] \n\n}",
        "options": {
          "timeout": 10000
        }
      },
      "id": "b726b48e-35c5-41fd-9ec3-b7006dad7739",
      "name": "ë„¤ì´ë²„ ê²€ìƒ‰ì–´ íŠ¸ë Œë“œ",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [
        -1240,
        -60
      ]
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "title"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -780,
        180
      ],
      "id": "0613a216-908f-40c9-ac3c-5215e62b33ff",
      "name": "Aggregate"
    },
    {
      "parameters": {
        "jsCode": "/**\n * n8n Code node\n * ì…ë ¥: HTTP Request ë…¸ë“œê°€ ë°˜í™˜í•œ JSON\n * ëª©ì : items[] ë°°ì—´ì„ ê°œë³„ ì•„ì´í…œìœ¼ë¡œ ë¶„ë¦¬â€†+â€†íƒœê·¸ ì œê±°\n * ì¶œë ¥: [{json:{title, link, pubDate, description}}, â€¦]\n */\nconst raw = $json;                     // HTTP ë…¸ë“œì—ì„œ ë„˜ì–´ì˜¨ í•œ ë©ì–´ë¦¬\nconst list = raw.items ?? [];          // safety\n\nreturn list.map(i => ({\n  json: {\n    title:       i.title.replace(/<[^>]*>/g, ''),        // <b>íƒœê·¸ ì œê±°\n    link:        i.link,\n    pubDate:     i.pubDate,\n    description: i.description.replace(/<[^>]*>/g, '')\n  }\n}));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -940,
        180
      ],
      "id": "7115aa4b-e3e4-4c19-8a55-bdebb48b9ced",
      "name": "Code"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://hyperclova-x-alpha-helsinki-agent-hotfix-250611.clops-inference.clova.ai/v2/generate",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer clops_7c8807d97ec8780cb11ac98061dc"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "charset",
              "value": "utf-8"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"top_k\": 1,\n  \"stop\": [\"<|stop|>\", \"<|endofturn|>\"],\n  \"max_tokens\": 8154,\n  \"temperature\": 0.5,\n  \"repeat_penalty\": 1.0,\n  \"prompt\": \"<|im_start|>system\\në‹¹ì‹ ì€ ê²½í—˜ ë§ì€ ë‰´ìŠ¤ë ˆí„° í¸ì§‘ì¥ì…ë‹ˆë‹¤. ë…ìì˜ ê´€ì‹¬ì‚¬(query)ë¥¼ ì •í™•íˆ íŒŒì•…í•˜ì—¬, ê·¸ë“¤ì—ê²Œ ê°€ì¥ ê°€ì¹˜ ìˆëŠ” ê¸°ì‚¬ë¥¼ ì„ ë³„í•˜ëŠ” ê²ƒì´ ë‹¹ì‹ ì˜ ì—­í• ì…ë‹ˆë‹¤.\\n\\nì‘ì—… ìˆœì„œ:\\n1. ë¨¼ì € ë…ìì˜ queryë¥¼ ë¶„ì„í•˜ì—¬ í•µì‹¬ ê´€ì‹¬ì‚¬ì™€ í‰ê°€ ê¸°ì¤€ì„ ë„ì¶œí•˜ì„¸ìš”\\n2. ë„ì¶œí•œ ê¸°ì¤€ì— ë”°ë¼ **ì œê³µëœ ëª¨ë“  ê¸°ì‚¬**ë“¤ì˜ ì‹¤ì§ˆì  ê°€ì¹˜ë¥¼ í‰ê°€í•˜ì„¸ìš”\\n3. ë‹¨ìˆœí•œ í‚¤ì›Œë“œ ë§¤ì¹­ì´ ì•„ë‹Œ, ì‹¤ì œ ë‚´ìš©ì˜ ê¹Šì´ì™€ ì‹¤ìš©ì„±ì„ ê³ ë ¤í•˜ì„¸ìš”\\n4. **ë°˜ë“œì‹œ ëª¨ë“  ê¸°ì‚¬ì— ìˆœìœ„ë¥¼ ë§¤ê¸°ì„¸ìš” (1ë“±ë¶€í„° ë§ˆì§€ë§‰ ë“±ìˆ˜ê¹Œì§€)**\\n\\në°˜ë“œì‹œ ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì¶œë ¥í•˜ì„¸ìš”:\\n{\\n  \\\"query_analysis\\\": {\\n    \\\"main_interest\\\": \\\"ë…ìì˜ í•µì‹¬ ê´€ì‹¬ì‚¬\\\",\\n    \\\"evaluation_criteria\\\": [\\\"ê¸°ì¤€1\\\", \\\"ê¸°ì¤€2\\\", \\\"ê¸°ì¤€3\\\"],\\n    \\\"total_articles\\\": ì´_ê¸°ì‚¬_ê°œìˆ˜\\n  },\\n  \\\"rankings\\\": [\\n    {\\\"rank\\\": 1, \\\"title\\\": \\\"ê¸°ì‚¬ ì œëª©\\\", \\\"reason\\\": \\\"ì„ ì • ì´ìœ \\\"},\\n    {\\\"rank\\\": 2, \\\"title\\\": \\\"ê¸°ì‚¬ ì œëª©\\\", \\\"reason\\\": \\\"ì„ ì • ì´ìœ \\\"},\\n    ... ëª¨ë“  ê¸°ì‚¬ í¬í•¨ ...\\n  ]\\n}\\n\\nJSON ì™¸ì— ë‹¤ë¥¸ í…ìŠ¤íŠ¸ëŠ” í¬í•¨í•˜ì§€ ë§ˆì„¸ìš”.<|im_end|>\\n<|im_start|>user\\nquery: AI ì„œë¹„ìŠ¤ ê¸°íšÂ·ê°œë°œ\\n\\në‹¤ìŒ 4ê°œ ê¸°ì‚¬ë¥¼ ëª¨ë‘ í‰ê°€í•´ì£¼ì„¸ìš”:\\n- êµ¬ê¸€, ìƒˆë¡œìš´ AI ëª¨ë¸ ë°œí‘œ\\n- ë‚ ì”¨ ì˜ˆë³´, ë‚´ì¼ ë§‘ìŒ\\n- ì‚¼ì„±ì „ì, AI ì¹© ê°œë°œ íˆ¬ì\\n- LGì „ì CEO, \\\"AIê°€ ì¤‘ìš”í•˜ë‹¤\\\" ë°œì–¸<|im_end|>\\n<|im_start|>assistant\\n{\\n  \\\"query_analysis\\\": {\\n    \\\"main_interest\\\": \\\"AI ì„œë¹„ìŠ¤ì˜ ì‹¤ì œ ê°œë°œê³¼ êµ¬í˜„\\\",\\n    \\\"evaluation_criteria\\\": [\\\"ê¸°ìˆ ì  êµ¬ì²´ì„±\\\", \\\"ì‹¤ë¬´ ì ìš© ê°€ëŠ¥ì„±\\\", \\\"ê°œë°œì/ê¸°íšìì—ê²Œ ì£¼ëŠ” ì¸ì‚¬ì´íŠ¸\\\"],\\n    \\\"total_articles\\\": 4\\n  },\\n  \\\"rankings\\\": [\\n    {\\\"rank\\\": 1, \\\"title\\\": \\\"êµ¬ê¸€, ìƒˆë¡œìš´ AI ëª¨ë¸ ë°œí‘œ\\\", \\\"reason\\\": \\\"ì‹¤ì œ ì‚¬ìš© ê°€ëŠ¥í•œ AI ëª¨ë¸ ë°œí‘œë¡œ ê°œë°œì— ì§ì ‘ í™œìš© ê°€ëŠ¥\\\"},\\n    {\\\"rank\\\": 2, \\\"title\\\": \\\"ì‚¼ì„±ì „ì, AI ì¹© ê°œë°œ íˆ¬ì\\\", \\\"reason\\\": \\\"AI ì„œë¹„ìŠ¤ ì¸í”„ë¼ ë°œì „ì— ê¸°ì—¬í•˜ëŠ” í•˜ë“œì›¨ì–´ ê°œë°œ\\\"},\\n    {\\\"rank\\\": 3, \\\"title\\\": \\\"LGì „ì CEO, 'AIê°€ ì¤‘ìš”í•˜ë‹¤' ë°œì–¸\\\", \\\"reason\\\": \\\"ê²½ì˜ì§„ ë°œì–¸ì€ íŠ¸ë Œë“œ ì°¸ê³ ìš©ì´ì§€ë§Œ ì‹¤ë¬´ì  ê°€ì¹˜ëŠ” ë‚®ìŒ\\\"},\\n    {\\\"rank\\\": 4, \\\"title\\\": \\\"ë‚ ì”¨ ì˜ˆë³´, ë‚´ì¼ ë§‘ìŒ\\\", \\\"reason\\\": \\\"AIì™€ ì „í˜€ ê´€ë ¨ ì—†ëŠ” ì¼ë°˜ ë‚ ì”¨ ì •ë³´\\\"}\\n  ]\\n}<|im_end|>\\n<|im_start|>user\\nquery: {{ $('query').item.json.query }}\\n\\në‹¤ìŒ {{$json.title.length}}ê°œ ê¸°ì‚¬ë¥¼ ëª¨ë‘ í‰ê°€í•´ì£¼ì„¸ìš”:\\n\\n{{$json.title}}<|im_end\\n<|im_start|>assistant\\n{\\n  \\\"query_analysis\\\": {\\n    \\\"main_interest\\\":\"\n}",
        "options": {
          "batching": {
            "batch": {
              "batchSize": 20
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -620,
        180
      ],
      "id": "025d705e-8266-46f9-8dc6-926684bcef53",
      "name": "HCX ë‰´ìŠ¤ ê¸°ì‚¬ ë¦¬ë­í‚¹"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://dev-chainer-api.io.naver.com/v1/chat-completions",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-Clops-Token",
              "value": "clops_7c8***"
            },
            {
              "name": "X-Chainer-Service-Name",
              "value": "news-summary"
            },
            {
              "name": "X-Clops-Model",
              "value": "https://hyperclova-x-alpha-helsinki-fixed-cand2-re.clops-inference.clova.ai"
            },
            {
              "name": "x-request-id",
              "value": "example1"
            },
            {
              "name": "X-Chainer-Debug",
              "value": "true"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"stream\": false,\n  \"temperature\": 0.5,\n  \"top_k\": null,\n  \"top_p\": 0.6,\n  \"repetition_penalty\": 1.05,\n  \"max_tokens\": 1152,\n  \"max_text_tokens\": 8192,\n  \"stop\": [\"<|im_end|>\", \"<|endofturn|>\"],\n  \"force_assistant_answer\": true,\n  \"messages\": [\n    {\n      \"role\": \"system\",\n      \"content\": \"#ëª©í‘œ(Objective)\\në‹¹ì‹ ì€ ì£¼ì–´ì§„ ê¸°ì‚¬ ì œëª©ì„ ë³´ê³  ì¤‘ìš”í•œ ìˆœì„œëŒ€ë¡œ title ì„ ì¬ë°°ì—´ í•©ë‹ˆë‹¤\"\n    },\n    {\n      \"role\": \"user\",\n      \"content\": \"ê¸°ì‚¬ ì œëª© : {{ $json.title }}\"\n    }\n  ]\n}",
        "options": {
          "batching": {
            "batch": {
              "batchSize": 20
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1040,
        -60
      ],
      "id": "957bc5a9-302a-4c35-abd1-4b2897f79258",
      "name": "Clova API Call1"
    },
    {
      "parameters": {
        "jsCode": "/******************************************************************\n * n8n Code node   â€”   HyperCLOVA-X ë‰´ìŠ¤ ë­í‚¹ íŒŒì„œ (Edge-case safe)\n * ì…ë ¥ : $json.choices[0].text (ì„ì˜ í˜•ì‹, <|im_end|> í¬í•¨)\n * ì¶œë ¥ : [{json:{rank,title,reason}}]  â€” rank ì˜¤ë¦„ì°¨ìˆœ\n ******************************************************************/\n\nconst raw = $json.choices?.[0]?.text ?? '';\nconst body = raw.split('<|')[0];                 // ë©”íƒ€ í† í° ì œê±°\n\n/*---------------------------------------------------------------\n  STEP-1  ìˆœìˆ˜ JSON ì°¾ê¸°   {...\"rankings\":[ {...}, ... ]}\n----------------------------------------------------------------*/\ntry {\n  const firstBrace = body.indexOf('{');\n  if (firstBrace !== -1) {\n    // JSON.parse ì—ëŸ¬ ë°©ì§€ë¥¼ ìœ„í•´ ë§ˆì§€ë§‰ '}' ìœ„ì¹˜ê¹Œì§€ ìë¦„\n    const lastBrace = body.lastIndexOf('}');\n    if (lastBrace > firstBrace) {\n      const cleaned = body.slice(firstBrace, lastBrace + 1)\n                           .replace(/,\\s*}/g, '}')         // trailing comma\n                           .replace(/,\\s*]/g, ']');        // trailing comma\n      const obj = JSON.parse(cleaned);\n      if (Array.isArray(obj.rankings)) return obj.rankings\n        .map(({rank,title,reason}) => ({json:{rank,title,reason}}))\n        .sort((a,b)=>a.json.rank-b.json.rank);\n    }\n  }\n} catch (_) { /* ëšâ€”ë‹¤ìŒ ë‹¨ê³„ */ }\n\n/*---------------------------------------------------------------\n  STEP-2  ê°ì²´ ë¸”ë¡ ë‹¨ìœ„ íŒŒì‹±  { \"rank\":n, \"title\":\"...\", ... }\n----------------------------------------------------------------*/\nconst blockRegex = /\\{[^{}]*?\"rank\"\\s*:\\s*\\d+[^{}]*?\"reason\"\\s*:\\s*\"[^\"]+?\"[^{}]*?}/gs;\nconst blocks = [...body.matchAll(blockRegex)].map(m=>m[0]);\nconst results = [];\n\nfor (const blk of blocks) {\n  try {\n    const safe = blk.replace(/,\\s*}/g,'}').replace(/,\\s*]/g,']');\n    const {rank,title,reason} = JSON.parse(safe);\n    results.push({rank,title,reason});\n  } catch {/* skip */}\n}\nif (results.length) {\n  results.sort((a,b)=>a.rank-b.rank);\n  return results.map(r=>({json:r}));\n}\n\n/*---------------------------------------------------------------\n  STEP-3  1-ë¼ì¸ íŒ¨í„´ íŒŒì‹±  \"rank\": n , \"title\": \"...\", \"reason\": \"...\"\n----------------------------------------------------------------*/\nconst lineRegex = /\"rank\"\\s*:\\s*(\\d+)[\\s\\S]+?\"title\"\\s*:\\s*\"([^\"]+?)\"[\\s\\S]+?\"reason\"\\s*:\\s*\"([^\"]+?)\"/g;\nlet m; let autoRank = 1;\nwhile ((m=lineRegex.exec(body))!==null) {\n  results.push({\n    rank:   Number(m[1]) || autoRank++,\n    title:  m[2],\n    reason: m[3]\n  });\n}\nif (!results.length) throw new Error('ë­í‚¹ ì •ë³´ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');\n\nresults.sort((a,b)=>a.rank-b.rank);\n\n// ì œëª© ì¤‘ë³µ ì œê±°(ì²« ë²ˆì§¸ë§Œ ë‚¨ê¹€)\nconst seen = new Set();\nconst unique = results.filter(r=>{\n  if (seen.has(r.title)) return false;\n  seen.add(r.title); return true;\n});\n\nreturn unique.map(r=>({json:r}));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -460,
        180
      ],
      "id": "24dbe932-0239-452f-9296-bd2c3cc45a04",
      "name": "Code1"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -300,
        180
      ],
      "id": "01ed54fd-a06c-48c9-b65e-8e768a4ad607",
      "name": "Merge"
    },
    {
      "parameters": {
        "jsCode": "/**\n * n8n Code node\n * INPUT  : ì„ì—¬-ìˆëŠ”  items  ( â‘  rankÂ·reason ì „ìš© â‘¡ linkÂ·pubDateÂ·description ì „ìš© )\n * OUTPUT : ë‘ ì •ë³´ë¥¼ í•©ì³ ì™„ì „í•œ ë‹¨ì¼ JSON ë°°ì—´\n *          {title, link, pubDate, description, rank, reason}\n */\n\nconst THRESHOLD = 0.45;  // ì œëª© ìœ ì‚¬ë„ ì„ê³„ê°’(0~1)â€•ë‚®ì¶œìˆ˜ë¡ ê´€ëŒ€í•œ ë³‘í•©\n\n/* ìœ ì‚¬ë„: ê³µë°±Â·êµ¬ë‘ì  ì œê±° í›„ Jaccard */\nfunction similarity(a, b) {\n  const clean = s => s.toLowerCase().replace(/[^\\p{L}\\p{N}\\s]/gu,'');\n  const A = new Set(clean(a).split(/\\s+/));\n  const B = new Set(clean(b).split(/\\s+/));\n  const inter = [...A].filter(x => B.has(x)).length;\n  return inter / (A.size + B.size - inter || 1);\n}\n\n/* ëˆ„ì  Map  titleKey â†’ ê°ì²´ */\nconst merged = [];\n\nfor (const { json } of items) {\n  const cur = { ...json };                       // ë³µì‚¬\n  const title = cur.title?.trim();\n  if (!title) continue;\n\n  // ê°€ì¥ ìœ ì‚¬í•œ ê¸°ì‚¬ ì°¾ê¸°\n  let bestIdx = -1, bestScore = 0;\n  merged.forEach((m, idx) => {\n    const s = similarity(title, m.title);\n    if (s > bestScore) { bestScore = s; bestIdx = idx; }\n  });\n\n  /* ìƒˆ ê·¸ë£¹ */\n  if (bestScore < THRESHOLD) {\n    merged.push(cur);\n    continue;\n  }\n\n  /* ë³‘í•© â€“ ë¹ˆ í•„ë“œëŠ” ì±„ì›Œ ë„£ê¸° */\n  const target = merged[bestIdx];\n  for (const k of ['link','pubDate','description','rank','reason']) {\n    if (target[k] === undefined || target[k] === null) target[k] = cur[k];\n  }\n}\n\n/* ì •ë ¬: rank ìˆëŠ” ê±´ ì˜¤ë¦„ì°¨ìˆœ, ì—†ìœ¼ë©´ ë’¤ë¡œ */\nmerged.sort((a,b)=> (a.rank??999) - (b.rank??999));\n\nreturn merged.map(j => ({ json: j }));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -140,
        180
      ],
      "id": "8f9eda1b-6667-4eaa-89bf-46e5bcb1295d",
      "name": "Code2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "fb92b8d6-5fbc-42a1-a9c9-69e08f871bf7",
              "name": "query",
              "value": "AI",
              "type": "string"
            },
            {
              "id": "835bf623-5b18-4a54-b322-983e50956afc",
              "name": "address",
              "value": "kangmj0825@gmail.com",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1260,
        180
      ],
      "id": "2e2591cb-af34-4e1e-b697-ef466745ebd8",
      "name": "query"
    },
    {
      "parameters": {
        "content": "## í‚¤ì›Œë“œ ê¸°ë°˜ ë„¤ì´ë²„ ë‰´ìŠ¤ ëª©ë¡ ìŠ¤í¬ë©",
        "height": 260,
        "width": 460
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1280,
        100
      ],
      "id": "06a62bd4-7a93-4c79-8f39-cf586d597d2c",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## ë„¤ì´ë²„ ë‰´ìŠ¤ ê¸°ì‚¬ Re-ranking\n",
        "height": 260,
        "width": 800
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -800,
        100
      ],
      "id": "14c21d8a-7e24-42b2-b735-de8d900bd9da",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "jsCode": "/* ---------- 0) ì˜¤ëŠ˜ ë‚ ì§œ ---------- */\nconst dateStr = new Date().toLocaleDateString('ko-KR', {\n  year:  'numeric',\n  month: 'long',\n  day:   'numeric',\n});\n\n/* ---------- ê³µí†µ ìƒìˆ˜ ---------- */\nconst OUTER_WRAP = `\n  width:100%;\n  max-width:600px;\n  border:1px solid #d9d9d9;\n  border-radius:8px;\n  font-family:Arial,Helvetica,sans-serif;\n  overflow:hidden;\n`;\n\n/* ---------- 1) HEADER ---------- */\nconst headerHtml = `\n  <table role=\"presentation\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\"\n         style=\"width:100%;margin:0 auto 32px;\">\n    <tr><td align=\"center\">\n      <table role=\"presentation\" cellpadding=\"0\" cellspacing=\"0\" style=\"${OUTER_WRAP}\">\n        <tr><td style=\"background:#61ba7a;padding:24px;text-align:center;\">\n\n          <!-- ë©”ì¸ íƒ€ì´í‹€ -->\n          <span style=\"display:block;font-size:28px;font-weight:bold;color:#fff;line-height:1.3;\">\n            &nbsp;HyperClova&nbsp;News&nbsp;Letter\n          </span>\n\n          <!-- ì•ˆë‚´ ë¬¸êµ¬ (ê°œì„ Â·í”¼ë“œë°± ë¬¸êµ¬) -->\n          <span style=\"display:block;margin-top:6px;font-size:13px;color:#e9ffe5;line-height:1.4;\">\n            ë³¸ ë‰´ìŠ¤ë ˆí„°ëŠ” AI ê¸°ìˆ ì„ í™œìš©í•´ ìë™ìœ¼ë¡œ ìˆ˜ì§‘Â·ì„ ë³„Â·ê°€ê³µëœ ì½˜í…ì¸ ì…ë‹ˆë‹¤.<br/>\n            ë” ë‚˜ì€ ì„œë¹„ìŠ¤ë¥¼ ìœ„í•´ ì§€ì†ì ìœ¼ë¡œ ê°œì„ í•˜ê³  ìˆìœ¼ë‹ˆ, ì†Œì¤‘í•œ ì˜ê²¬ì„ ë¶€íƒë“œë¦½ë‹ˆë‹¤.\n          </span>\n\n        </td></tr>\n      </table>\n    </td></tr>\n  </table>\n`;\n\n/* ---------- 2) ë³¸ë¬¸ ---------- */\nconst bodyPlaceholder = $input.first().json.htmlBlocks;\n\n/* ---------- 3) CTA(ë²„íŠ¼) ---------- */\nconst ctaHtml = `\n  <table role=\"presentation\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"width:100%;margin:0 auto 32px auto;\">\n    <tr><td align=\"center\">\n      <table role=\"presentation\" cellpadding=\"0\" cellspacing=\"0\" style=\"${OUTER_WRAP}\">\n        <tr><td style=\"padding:24px;text-align:center;\">\n          <h2 style=\"margin:0 0 18px 0;font-size:24px;color:#333;\">ì˜¤ëŠ˜ì˜ ë‰´ìŠ¤ë¥¼ ë” ìì„¸íˆ ì•Œê³ ì‹¶ë‹¤ë©´?</h2>\n          <a href=\"https://agent.io.naver.com/agent/ai_newsletter\" style=\"\n            display:inline-block;\n            background:#61ba7a;\n            color:#fff;\n            font-size:16px;\n            font-weight:bold;\n            padding:12px 28px;\n            border-radius:24px;\n            text-decoration:none;\n          \">ì—ì´ì „íŠ¸ì—ê²Œ ë¬¼ì–´ë³´ê¸° â†’</a>\n        </td></tr>\n      </table>\n    </td></tr>\n  </table>\n`;\n\n/* ---------- 4) FOOTER ---------- */\nconst footerHtml = `\n  <table role=\"presentation\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"width:100%;margin:32px auto 0 auto;\">\n    <tr><td align=\"center\">\n      <table role=\"presentation\" cellpadding=\"0\" cellspacing=\"0\" style=\"${OUTER_WRAP}\">\n        <tr><td style=\"background:#222;padding:24px;color:#fff;font-size:12px;line-height:1.6;text-align:left;\">\n          <p style=\"margin:0 0 12px 0;\">\n            ìœ„ ì „ììš°í¸ ë° ê·¸ì— í¬í•¨ëœ ì •ë³´ëŠ” ìœ„ì— ê¸°ì¬ëœ ìˆ˜ì‹ ì¸ë§Œì„ ìœ„í•´ ë°œì†¡ë˜ëŠ” ê²ƒìœ¼ë¡œì„œ ë³´ì•ˆì„\n            ìœ ì§€í•´ì•¼ í•˜ëŠ” ì •ë³´ ë° ë²•ë¥ ìƒ ë˜ëŠ” ë‹¤ë¥¸ ì‚¬ìœ ë¡œ ì¸í•˜ì—¬ ê³µê°œê°€ ê¸ˆì§€ëœ ì •ë³´ê°€ ë“¤ì–´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n            ê·€í•˜ê°€ ì´ ì „ììš°í¸ì˜ ì§€ì • ìˆ˜ì‹ ì¸ì´ ì•„ë‹ˆë©´ ì´ë¥¼ ë¬´ë‹¨ìœ¼ë¡œ ë³´ìœ , ë³µì œ, ì „ì†¡, ë°°í¬, ê³µê°œí•  ìˆ˜ ì—†ìœ¼ë©°,\n            ì¼ë¶€ì˜ ë‚´ìš©ì´ë¼ë„ ë³´ìœ , ë³µì œ, ë°°í¬, ê³µê°œí•´ì„œëŠ” ì•ˆë©ë‹ˆë‹¤. ì˜ëª» ìˆ˜ì‹ ëœ ê²½ìš°ì—ëŠ” ì¦‰ì‹œ\n            <a href=\"mailto:dl_ncloud_privacy@navercorp.com\" style=\"color:#61ba7a;text-decoration:none;\">ë„¤ì´ë²„ í´ë¼ìš°ë“œ ê°œì¸ì •ë³´ë³´í˜¸(dl_ncloud_privacy@navercorp.com)</a>ë¡œ\n            ì—°ë½í•˜ì—¬ ì£¼ì‹œê³ , ì›ë³¸ ë° ì‚¬ë³¸ê³¼ ê·¸ì— ë”°ë¥¸ ì²¨ë¶€ ë¬¸ì„œë¥¼ ëª¨ë‘ ì‚­ì œí•˜ì—¬ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.\n          </p>\n          <p style=\"margin:0;\">\n            This email and the information contained in this email are intended solely for the recipient(s) addressed above\n            and may contain information that is confidential and/or privileged or whose disclosure is prohibited by law or\n            other reasons. If you are not the intended recipient, any unauthorized storage, duplication, dissemination,\n            distribution or disclosure is strictly prohibited. If you received this email in error, please immediately\n            contact <a href=\"mailto:dl_ncloud_privacy@navercorp.com\" style=\"color:#61ba7a;text-decoration:none;\">NAVER Cloud Privacy</a>\n            and delete this email and any copies/attachments from your system.\n          </p>\n        </td></tr>\n      </table>\n    </td></tr>\n  </table>\n`;\n\n/* ---------- 5) ìµœì¢… HTML ---------- */\nconst finalHtml = headerHtml + bodyPlaceholder + ctaHtml + footerHtml;\n\n/* ---------- 6) ë°˜í™˜ ---------- */\nreturn [\n  { json: { htmlBlocks: finalHtml } }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        240,
        180
      ],
      "id": "7a8ab316-92a2-4994-a569-b54d57cd1c34",
      "name": "Header/Footer HTML4"
    },
    {
      "parameters": {
        "fromEmail": "raphael825@naver.com",
        "toEmail": "={{ $node[\"query\"].json.address }}",
        "subject": "=Hyperclova News Letter ",
        "emailFormat": "html",
        "html": "={{ $json.htmlBlocks }}",
        "options": {}
      },
      "id": "1a706b13-4982-4a57-bc3a-5459b3434717",
      "name": "ì´ë©”ì¼ ë°œì†¡",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2,
      "position": [
        400,
        180
      ],
      "webhookId": "4dd3504c-cc2b-477e-83ae-e4ea472ab20e",
      "credentials": {
        "smtp": {
          "id": "FP2VjQFtER33dKXx",
          "name": "SMTP account"
        }
      }
    },
    {
      "parameters": {
        "content": "## ë‰´ìŠ¤ë ˆí„° ì „ì†¡ \n",
        "height": 260,
        "width": 620
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        20,
        100
      ],
      "id": "f8249de6-7017-4784-bd70-6a0b133c4710",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "jsCode": "/**\n * n8n Function â–¸ \"HTML ì´ë©”ì¼ ìƒì„±\"\n * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n * ì¸í’‹: ê° ì•„ì´í…œì— rank, title, reason, link, pubDate, description í•„ë“œê°€ ì¡´ì¬\n * ì•„ì›ƒ: [{ json: { htmlBlocks: â€¦ } }]\n * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n */\n\n/* 0) ì˜¤ëŠ˜ ë‚ ì§œ */\nconst dateStr = new Date().toLocaleDateString('ko-KR', {\n  year: 'numeric', month: 'long', day: 'numeric',\n});\n\n/* 1) ê³µí†µ ìŠ¤íƒ€ì¼ */\nconst WRAPPER_STYLE = `\n  width:100%;max-width:600px;border:1px solid #d9d9d9;border-radius:8px;\n  font-family:Arial,Helvetica,sans-serif;\n`;\n\n/* 2) ë¯¸ë¦¬ë³´ê¸° ë¸”ë¡ */\nconst previewTitles = items\n  .slice(0, 5)  // ìƒìœ„ 5ê°œë§Œ ë¯¸ë¦¬ë³´ê¸°ì— í‘œì‹œ\n  .map((item, idx) => `${idx + 1}. ${item.json.title}`)\n  .join('<br/>');\n\nconst previewHtml = `\n  <table role=\"presentation\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"width:100%;margin:0 auto 32px;\">\n    <tr><td align=\"center\">\n      <table role=\"presentation\" cellpadding=\"0\" cellspacing=\"0\" style=\"${WRAPPER_STYLE}\">\n        <tr><td style=\"padding:24px;\">\n          <h2 style=\"margin:0 0 16px;font-size:24px;font-weight:bold;color:#61ba7a;\">${dateStr} AI ì£¼ìš” ì†Œì‹ TOP 5</h2>\n          <p style=\"font-size:16px;line-height:1.6;color:#111;margin:0;\">${previewTitles}</p>\n        </td></tr>\n      </table>\n    </td></tr>\n  </table>\n`;\n\n/* 3) ê¸°ì‚¬ ì¹´ë“œ + í”¼ë“œë°± ë§í¬ */\nconst BASE_URL = 'https://hcx-n8n.io.naver.com/webhook/get_score';\n\n// ìƒìœ„ 10ê°œ ê¸°ì‚¬ë§Œ í‘œì‹œ\nconst cardsHtml = items.slice(0, 10).map((item, idx) => {\n  const a = item.json;\n\n  /* â”€â”€ rank ë¼ë²¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  const rankLabel = a.rank\n    ? `<p style=\"font-size:14px;color:#61ba7a;margin:0 0 4px;text-align:left;font-weight:bold;\">\n         AI ê´€ë ¨ë„ ${a.rank}ìœ„\n       </p>`\n    : '';\n\n  /* â”€â”€ ì„ ì • ì´ìœ  (reason) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  const reasonBlock = a.reason\n    ? `<div style=\"background:#f5f5f5;padding:12px;border-radius:6px;margin:0 0 16px;\">\n         <p style=\"font-size:14px;color:#666;margin:0;font-style:italic;\">\n           ğŸ’¡ ì„ ì • ì´ìœ : ${a.reason}\n         </p>\n       </div>`\n    : '';\n\n  /* â”€â”€ ë³¸ë¬¸ (description) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  const body = a.description\n    ? `<p style=\"font-size:16px;line-height:1.6;margin:0 0 18px;color:#333;\">\n         ${a.description.substring(0, 200)}${a.description.length > 200 ? '...' : ''}\n       </p>`\n    : '';\n\n  /* â”€â”€ ë°œí–‰ì¼ (pubDate) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  const pubDateLabel = a.pubDate\n    ? `<p style=\"font-size:13px;color:#999;margin:0 0 12px;\">\n         ğŸ“… ${new Date(a.pubDate).toLocaleDateString('ko-KR', {\n           year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit'\n         })}\n       </p>`\n    : '';\n\n  /* â”€â”€ 1-5 ì ìˆ˜ ë§í¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  const feedback = Array.from({ length: 5 }, (_, n) => n + 1)\n    .map(n => `\n      <a href=\"${BASE_URL}?url=${encodeURIComponent(a.link || a.url)}&score=${n}\"\n         style=\"display:inline-block;width:24px;font-size:16px;margin:0 4px;\n                text-decoration:none;color:#61ba7a;\">${n}</a>`)\n    .join('');\n\n  /* â”€â”€ ì¹´ë“œ HTML â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n  return `\n    <table role=\"presentation\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"width:100%;margin:0 auto 32px;\">\n      <tr><td align=\"center\">\n        <table role=\"presentation\" cellpadding=\"0\" cellspacing=\"0\" style=\"${WRAPPER_STYLE}\">\n          <tr><td style=\"padding:24px;\">\n\n            ${rankLabel}\n\n            <h2 style=\"margin:0 0 16px;font-size:22px;line-height:1.3;\">\n              <a href=\"${a.link || a.url}\" style=\"color:#61ba7a;text-decoration:none;\">${a.title}</a>\n            </h2>\n\n            ${pubDateLabel}\n            ${reasonBlock}\n            ${body}\n\n            <a href=\"${a.link || a.url}\" style=\"color:#61ba7a;font-size:16px;font-weight:bold;text-decoration:none;\">\n              ìì„¸íˆ ë³´ê¸° â†’\n            </a>\n\n            <hr style=\"border:none;border-top:1px solid #d9d9d9;margin:24px 0;\"/>\n\n            <p style=\"font-size:16px;font-weight:bold;text-align:center;margin:0 0 12px;color:#111;\">\n              ì´ ê¸°ì‚¬, ì–´ë• ë‚˜ìš”?\n            </p>\n            <p style=\"font-size:12px;color:#777;margin:0 0 12px;text-align:center;\">\n              ëª¨ë°”ì¼ì—ì„  ì•„ì§ í‰ì ì´ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.<br/>\n              ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ ì°¸ì—¬í•´ ì£¼ì„¸ìš”.\n            </p>\n\n            <div style=\"text-align:center;\">${feedback}</div>\n\n          </td></tr>\n        </table>\n      </td></tr>\n    </table>\n  `;\n}).join('');\n\n/* 4) ê²°ê³¼ ë°˜í™˜ */\nreturn [{ json: { htmlBlocks: previewHtml + cardsHtml } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        60,
        180
      ],
      "id": "86a48f4b-d03a-476d-a53f-bda389db8d7a",
      "name": "News Block HTML"
    }
  ],
  "pinData": {},
  "connections": {
    "ë„¤ì´ë²„ ë‰´ìŠ¤ ê²€ìƒ‰ (Naver API)": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "HCX ë‰´ìŠ¤ ê¸°ì‚¬ ë¦¬ë­í‚¹",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "HCX ë‰´ìŠ¤ ê¸°ì‚¬ ë¦¬ë­í‚¹": {
      "main": [
        [
          {
            "node": "Code1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code1": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Code2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "query": {
      "main": [
        [
          {
            "node": "ë„¤ì´ë²„ ë‰´ìŠ¤ ê²€ìƒ‰ (Naver API)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code2": {
      "main": [
        [
          {
            "node": "News Block HTML",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Header/Footer HTML4": {
      "main": [
        [
          {
            "node": "ì´ë©”ì¼ ë°œì†¡",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "News Block HTML": {
      "main": [
        [
          {
            "node": "Header/Footer HTML4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook íŠ¸ë¦¬ê±°": {
      "main": [
        [
          {
            "node": "query",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "81e38421-506c-4ff6-bb58-e54cc39c358b",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "5b40a9494f24c8b44272b9f4d7c9963f14b3c071b2bdbe4d4eb707fe6a8210b2"
  },
  "id": "wq4UXGzUmmGSXeB8",
  "tags": []
}