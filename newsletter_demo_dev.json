{
  "name": "newsletter-demo-dev",
  "nodes": [
    {
      "parameters": {
        "url": "https://openapi.naver.com/v1/search/news.json",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "query",
              "value": "={{ $json.query }}"
            },
            {
              "name": "display",
              "value": "20"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-Naver-Client-Id",
              "value": "=ukBNYmnsfjlX82JImWyp"
            },
            {
              "name": "X-Naver-Client-Secret",
              "value": "Nz6VHqzBjR"
            }
          ]
        },
        "options": {
          "timeout": 10000
        }
      },
      "id": "75963888-ba4f-4a58-a5db-8dbc4973358b",
      "name": "ë„¤ì´ë²„ ë‰´ìŠ¤ ê²€ìƒ‰ (Naver API)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [
        360,
        100
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://hyperclova-x-alpha-helsinki-agent-hotfix-250611.clops-inference.clova.ai/v2/generate",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer clops_7c8807d97ec8780cb11ac98061dc"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "charset",
              "value": "utf-8"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"top_k\": 1,\n  \"stop\": [\"<|stop|>\", \"<|endofturn|>\"],\n  \"max_tokens\": 8154,\n  \"temperature\": 0.5,\n  \"repeat_penalty\": 1.0,\n  \"prompt\": \"<|im_start|>system\\në‹¹ì‹ ì€ ê²½í—˜ ë§ì€ ë‰´ìŠ¤ë ˆí„° í¸ì§‘ì¥ì…ë‹ˆë‹¤. ë…ìì˜ ê´€ì‹¬ì‚¬(query)ì™€ ì •ë ¬ ê¸°ì¤€(sorting)ì— ë§ì¶° ê¸°ì‚¬ë¥¼ í‰ê°€í•˜ëŠ” ì „ë¬¸ê°€ì…ë‹ˆë‹¤.\\n\\nì‘ì—… ìˆœì„œ:\\n1. queryì™€ sortingì„ ë¶„ì„í•˜ì—¬ ì •í™•í•œ í‰ê°€ ê¸°ì¤€ì„ ìˆ˜ë¦½í•˜ì„¸ìš”\\n2. sortingì´ ìˆë‹¤ë©´ ë°˜ë“œì‹œ ê·¸ê²ƒì„ ìµœìš°ì„  ê¸°ì¤€ìœ¼ë¡œ ì‚¼ìœ¼ì„¸ìš”\\n3. ê° ê¸°ì‚¬ê°€ sorting ê¸°ì¤€ì— ì–¼ë§ˆë‚˜ ë¶€í•©í•˜ëŠ”ì§€ êµ¬ì²´ì ìœ¼ë¡œ í‰ê°€í•˜ì„¸ìš”\\n4. ëª¨ë“  ê¸°ì‚¬ì— ìˆœìœ„ë¥¼ ë§¤ê¸°ë˜, sorting ê¸°ì¤€ì— ê°€ì¥ ì˜ ë§ëŠ” ìˆœì„œë¡œ ì •ë ¬í•˜ì„¸ìš”\\n\\nì¤‘ìš”: sortingì´ \\\"ì‹ ëª¨ë¸ ê°œë°œ\\\"ì´ë©´ ì‹¤ì œ AI ëª¨ë¸ì„ ìƒˆë¡œ ê°œë°œí•˜ëŠ” ë‚´ìš©ì„ ìµœìš°ì„ ìœ¼ë¡œ, \\\"íˆ¬ì ë™í–¥\\\"ì´ë©´ íˆ¬ì ê´€ë ¨ ë‚´ìš©ì„ ìµœìš°ì„ ìœ¼ë¡œ í‰ê°€í•˜ì„¸ìš”.\\n\\në°˜ë“œì‹œ ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì¶œë ¥í•˜ì„¸ìš”:\\n{\\n  \\\"query_analysis\\\": {\\n    \\\"main_interest\\\": \\\"ë…ìì˜ í•µì‹¬ ê´€ì‹¬ì‚¬\\\",\\n    \\\"sorting_focus\\\": \\\"ì •ë ¬ ê¸°ì¤€ì˜ í•µì‹¬ í¬ì¸íŠ¸\\\",\\n    \\\"evaluation_criteria\\\": [\\\"ê¸°ì¤€1\\\", \\\"ê¸°ì¤€2\\\", \\\"ê¸°ì¤€3\\\"],\\n    \\\"total_articles\\\": ì´_ê¸°ì‚¬_ê°œìˆ˜\\n  },\\n  \\\"rankings\\\": [\\n    {\\\"rank\\\": 1, \\\"title\\\": \\\"ê¸°ì‚¬ ì œëª©\\\", \\\"reason\\\": \\\"ì„ ì • ì´ìœ  (sorting ê¸°ì¤€ ê´€ë ¨ì„± ëª…ì‹œ)\\\"},\\n    ... ëª¨ë“  ê¸°ì‚¬ í¬í•¨ ...\\n  ]\\n}\\n\\nJSON ì™¸ì— ë‹¤ë¥¸ í…ìŠ¤íŠ¸ëŠ” í¬í•¨í•˜ì§€ ë§ˆì„¸ìš”. #Example Input : query: AI ì„œë¹„ìŠ¤ ê¸°íšÂ·ê°œë°œ\\nsorting: ì‹ ëª¨ë¸ ê°œë°œ\\n\\në‹¤ìŒ 5ê°œ ê¸°ì‚¬ë¥¼ ëª¨ë‘ í‰ê°€í•´ì£¼ì„¸ìš”:\\n- SKí…”ë ˆì½¤, ìì²´ AI ëª¨ë¸ ê¸°ë°˜í•œ ë¬¸ì„œ í•´ì„ ê¸°ìˆ  ê³µê°œ\\n- í¬ë˜í”„í†¤Â·SKT, ìˆ˜í•™ íŠ¹í™” LLM ê³µë™ ê°œë°œ\\n- ì „ë¶TP, ChatGPT í™œìš© êµìœ¡ ì‹¤ì‹œ\\n- AI ì¸í”„ë¼ íŒ í‚¤ìš´ ê³¼ê¸°ì •í†µë¶€\\n- ì‚¼ì„±ì „ì, AI ì¹© 2ë‚˜ë…¸ ìƒì‚° #Example Output {\\n  \\\"query_analysis\\\": {\\n    \\\"main_interest\\\": \\\"AI ì„œë¹„ìŠ¤ì˜ ê¸°íšê³¼ ê°œë°œ\\\",\\n    \\\"sorting_focus\\\": \\\"ìƒˆë¡œìš´ AI ëª¨ë¸ì„ ì‹¤ì œë¡œ ê°œë°œí•˜ëŠ” í™œë™\\\",\\n    \\\"evaluation_criteria\\\": [\\\"ì‹ ê·œ AI ëª¨ë¸ ê°œë°œ ì—¬ë¶€\\\", \\\"ëª¨ë¸ ê°œë°œì˜ ê¸°ìˆ ì  êµ¬ì²´ì„±\\\", \\\"ê°œë°œ ì„±ê³¼ì˜ í˜ì‹ ì„±\\\"],\\n    \\\"total_articles\\\": 5\\n  },\\n  \\\"rankings\\\": [\\n    {\\\"rank\\\": 1, \\\"title\\\": \\\"í¬ë˜í”„í†¤Â·SKT, ìˆ˜í•™ íŠ¹í™” LLM ê³µë™ ê°œë°œ\\\", \\\"reason\\\": \\\"ì‹¤ì œë¡œ ìƒˆë¡œìš´ LLM ëª¨ë¸ì„ ê³µë™ ê°œë°œí•˜ëŠ” í”„ë¡œì íŠ¸ë¡œ ì‹ ëª¨ë¸ ê°œë°œì— ì •í™•íˆ ë¶€í•©\\\"},\\n    {\\\"rank\\\": 2, \\\"title\\\": \\\"SKí…”ë ˆì½¤, ìì²´ AI ëª¨ë¸ ê¸°ë°˜í•œ ë¬¸ì„œ í•´ì„ ê¸°ìˆ  ê³µê°œ\\\", \\\"reason\\\": \\\"ìì²´ AI ëª¨ë¸ì„ ë³´ìœ í•˜ê³  ìˆìœ¼ë‚˜, ì‹ ê·œ ê°œë°œë³´ë‹¤ëŠ” ê¸°ì¡´ ëª¨ë¸ì˜ í™œìš© ê¸°ìˆ ì— ê°€ê¹Œì›€\\\"},\\n    {\\\"rank\\\": 3, \\\"title\\\": \\\"ì‚¼ì„±ì „ì, AI ì¹© 2ë‚˜ë…¸ ìƒì‚°\\\", \\\"reason\\\": \\\"AI ëª¨ë¸ ê°œë°œì„ ìœ„í•œ í•˜ë“œì›¨ì–´ ì¸í”„ë¼ì´ì§€ë§Œ ëª¨ë¸ ìì²´ ê°œë°œì€ ì•„ë‹˜\\\"},\\n    {\\\"rank\\\": 4, \\\"title\\\": \\\"AI ì¸í”„ë¼ íŒ í‚¤ìš´ ê³¼ê¸°ì •í†µë¶€\\\", \\\"reason\\\": \\\"AI ê°œë°œ í™˜ê²½ ì¡°ì„±ì— ê¸°ì—¬í•˜ì§€ë§Œ ì§ì ‘ì ì¸ ëª¨ë¸ ê°œë°œì€ ì•„ë‹˜\\\"},\\n    {\\\"rank\\\": 5, \\\"title\\\": \\\"ì „ë¶TP, ChatGPT í™œìš© êµìœ¡ ì‹¤ì‹œ\\\", \\\"reason\\\": \\\"ê¸°ì¡´ ëª¨ë¸ í™œìš© êµìœ¡ìœ¼ë¡œ ì‹ ëª¨ë¸ ê°œë°œê³¼ëŠ” ê´€ë ¨ì„±ì´ ë‚®ìŒ\\\"}\\n  ]\\n}<|im_end|>\\n<|im_start|>user\\nquery: {{ $node['query'].json.query }}\\nsorting: {{ $node['query'].json.sorting }}\\n\\në‹¤ìŒ {{$json.title.length}}ê°œ ê¸°ì‚¬ë¥¼ ëª¨ë‘ í‰ê°€í•´ì£¼ì„¸ìš”:\\n\\n{{$json.title}}<|im_end|>\\n<|im_start|>assistant\\n {\\n  \\\"query_analysis\\\"\"\n}",
        "options": {
          "batching": {
            "batch": {
              "batchSize": 20
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        840,
        100
      ],
      "id": "a448db36-4f16-48e4-aaca-38fee166fa56",
      "name": "HCX ë‰´ìŠ¤ ê¸°ì‚¬ ë¦¬ë­í‚¹"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        1140,
        100
      ],
      "id": "d458bf04-229b-49e8-a477-d1869542c6df",
      "name": "Merge"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0a14fc15-dcc7-4715-b0bb-7ad2d0be136f",
              "name": "query",
              "value": "={{ $json.query }}",
              "type": "string"
            },
            {
              "id": "6bde02c7-c86c-4250-90c9-2bb4744fa4d0",
              "name": "address",
              "value": "={{ $json.address }}",
              "type": "string"
            },
            {
              "id": "1e185e3f-3385-4e43-a149-d6a11b18fb2e",
              "name": "language",
              "value": "={{ $json.language }}",
              "type": "string"
            },
            {
              "id": "92f41a4b-c213-4c34-b1c9-325910c096b3",
              "name": "sorting",
              "value": "={{ $json.sorting }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        220,
        100
      ],
      "id": "7656dd62-35b3-4d64-a5d8-3d3c32aa0b28",
      "name": "query"
    },
    {
      "parameters": {
        "content": "## í‚¤ì›Œë“œ ê¸°ë°˜ ë„¤ì´ë²„ ë‰´ìŠ¤ ëª©ë¡ ìŠ¤í¬ë©\në„¤ì´ë²„ ë‰´ìŠ¤ API í™œìš© \n",
        "height": 260,
        "width": 600
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        200,
        0
      ],
      "id": "49c9d8e0-6b32-4a96-8c99-e1df8f9a9cc5",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## ë„¤ì´ë²„ ë‰´ìŠ¤ ê¸°ì‚¬ Re-ranking\nHelsinki-alpha model ì‚¬ìš© (chat model ì•„ë‹˜) \n\n",
        "height": 260,
        "width": 720
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        820,
        0
      ],
      "id": "233cc4ee-888e-4109-ac66-ad75c883b3c6",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "jsCode": "/* ---------- 0) ì˜¤ëŠ˜ ë‚ ì§œ ---------- */\nconst dateStr = new Date().toLocaleDateString('ko-KR', {\n  year:  'numeric',\n  month: 'long',\n  day:   'numeric',\n});\n\n/* ---------- ê³µí†µ ìƒìˆ˜ ---------- */\nconst OUTER_WRAP = `\n  width:100%;\n  max-width:600px;\n  border:1px solid #d9d9d9;\n  border-radius:8px;\n  font-family:Arial,Helvetica,sans-serif;\n  overflow:hidden;\n`;\n\n/* ---------- 1) HEADER ---------- */\nconst headerHtml = `\n  <table role=\"presentation\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\"\n         style=\"width:100%;margin:0 auto 32px;\">\n    <tr><td align=\"center\">\n      <table role=\"presentation\" cellpadding=\"0\" cellspacing=\"0\" style=\"${OUTER_WRAP}\">\n        <tr><td style=\"background:#61ba7a;padding:24px;text-align:center;\">\n\n          <!-- ë©”ì¸ íƒ€ì´í‹€ -->\n          <span style=\"display:block;font-size:28px;font-weight:bold;color:#fff;line-height:1.3;\">\n            &nbsp;HyperClova&nbsp;News&nbsp;Letter\n          </span>\n\n          <!-- ì•ˆë‚´ ë¬¸êµ¬ (ê°œì„ Â·í”¼ë“œë°± ë¬¸êµ¬) -->\n          <span style=\"display:block;margin-top:6px;font-size:13px;color:#e9ffe5;line-height:1.4;\">\n            ë³¸ ë‰´ìŠ¤ë ˆí„°ëŠ” AI ê¸°ìˆ ì„ í™œìš©í•´ ìë™ìœ¼ë¡œ ìˆ˜ì§‘Â·ì„ ë³„Â·ê°€ê³µëœ ì½˜í…ì¸ ì…ë‹ˆë‹¤.<br/>\n            ë” ë‚˜ì€ ì„œë¹„ìŠ¤ë¥¼ ìœ„í•´ ì§€ì†ì ìœ¼ë¡œ ê°œì„ í•˜ê³  ìˆìœ¼ë‹ˆ, ì†Œì¤‘í•œ ì˜ê²¬ì„ ë¶€íƒë“œë¦½ë‹ˆë‹¤.\n          </span>\n\n        </td></tr>\n      </table>\n    </td></tr>\n  </table>\n`;\n\n/* ---------- 2) ë³¸ë¬¸ ---------- */\nconst bodyPlaceholder = $input.first().json.htmlBlocks;\n\n\n/* ---------- 4) FOOTER ---------- */\nconst footerHtml = `\n  <table role=\"presentation\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"width:100%;margin:32px auto 0 auto;\">\n    <tr><td align=\"center\">\n      <table role=\"presentation\" cellpadding=\"0\" cellspacing=\"0\" style=\"${OUTER_WRAP}\">\n        <tr><td style=\"background:#222;padding:24px;color:#fff;font-size:12px;line-height:1.6;text-align:left;\">\n          <p style=\"margin:0 0 12px 0;\">\n            ìœ„ ì „ììš°í¸ ë° ê·¸ì— í¬í•¨ëœ ì •ë³´ëŠ” ìœ„ì— ê¸°ì¬ëœ ìˆ˜ì‹ ì¸ë§Œì„ ìœ„í•´ ë°œì†¡ë˜ëŠ” ê²ƒìœ¼ë¡œì„œ ë³´ì•ˆì„\n            ìœ ì§€í•´ì•¼ í•˜ëŠ” ì •ë³´ ë° ë²•ë¥ ìƒ ë˜ëŠ” ë‹¤ë¥¸ ì‚¬ìœ ë¡œ ì¸í•˜ì—¬ ê³µê°œê°€ ê¸ˆì§€ëœ ì •ë³´ê°€ ë“¤ì–´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n            ê·€í•˜ê°€ ì´ ì „ììš°í¸ì˜ ì§€ì • ìˆ˜ì‹ ì¸ì´ ì•„ë‹ˆë©´ ì´ë¥¼ ë¬´ë‹¨ìœ¼ë¡œ ë³´ìœ , ë³µì œ, ì „ì†¡, ë°°í¬, ê³µê°œí•  ìˆ˜ ì—†ìœ¼ë©°,\n            ì¼ë¶€ì˜ ë‚´ìš©ì´ë¼ë„ ë³´ìœ , ë³µì œ, ë°°í¬, ê³µê°œí•´ì„œëŠ” ì•ˆë©ë‹ˆë‹¤. ì˜ëª» ìˆ˜ì‹ ëœ ê²½ìš°ì—ëŠ” ì¦‰ì‹œ\n            <a href=\"mailto:dl_ncloud_privacy@navercorp.com\" style=\"color:#61ba7a;text-decoration:none;\">ë„¤ì´ë²„ í´ë¼ìš°ë“œ ê°œì¸ì •ë³´ë³´í˜¸(dl_ncloud_privacy@navercorp.com)</a>ë¡œ\n            ì—°ë½í•˜ì—¬ ì£¼ì‹œê³ , ì›ë³¸ ë° ì‚¬ë³¸ê³¼ ê·¸ì— ë”°ë¥¸ ì²¨ë¶€ ë¬¸ì„œë¥¼ ëª¨ë‘ ì‚­ì œí•˜ì—¬ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.\n          </p>\n          <p style=\"margin:0;\">\n            This email and the information contained in this email are intended solely for the recipient(s) addressed above\n            and may contain information that is confidential and/or privileged or whose disclosure is prohibited by law or\n            other reasons. If you are not the intended recipient, any unauthorized storage, duplication, dissemination,\n            distribution or disclosure is strictly prohibited. If you received this email in error, please immediately\n            contact <a href=\"mailto:dl_ncloud_privacy@navercorp.com\" style=\"color:#61ba7a;text-decoration:none;\">NAVER Cloud Privacy</a>\n            and delete this email and any copies/attachments from your system.\n          </p>\n        </td></tr>\n      </table>\n    </td></tr>\n  </table>\n`;\n\n/* ---------- 5) ìµœì¢… HTML ---------- */\nconst finalHtml = headerHtml + bodyPlaceholder + footerHtml;\n\n/* ---------- 6) ë°˜í™˜ ---------- */\nreturn [\n  { json: { htmlBlocks: finalHtml } }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1740,
        100
      ],
      "id": "d83f0d54-5faa-41cc-9654-83ac85e7c93f",
      "name": "Header/Footer HTML4"
    },
    {
      "parameters": {
        "fromEmail": "raphael825@naver.com",
        "toEmail": "={{ $node[\"query\"].json.address }}",
        "subject": "=AI ë‰´ìŠ¤ë ˆí„° - {{ $node[\"query\"].json.query }}",
        "emailFormat": "html",
        "html": "={{ $json.htmlBlocks }}",
        "options": {}
      },
      "id": "8a4e4e9f-1c09-4f97-be11-a6d36036dc1e",
      "name": "ì´ë©”ì¼ ë°œì†¡",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2,
      "position": [
        1900,
        100
      ],
      "webhookId": "4dd3504c-cc2b-477e-83ae-e4ea472ab20e",
      "credentials": {
        "smtp": {
          "id": "FP2VjQFtER33dKXx",
          "name": "SMTP account"
        }
      }
    },
    {
      "parameters": {
        "content": "## ë‰´ìŠ¤ë ˆí„° ì „ì†¡ \n",
        "height": 260,
        "width": 480
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1560,
        0
      ],
      "id": "0858723f-1548-4b56-8d3b-2f56f787ff06",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "jsCode": "/**\n * n8n Function â–¸ \"HTML ì´ë©”ì¼ ìƒì„±\"\n * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n * ì¸í’‹: ê° ì•„ì´í…œì— rank, title, reason, link, pubDate, description í•„ë“œ\n * ì•„ì›ƒ: [{ json: { htmlBlocks: â€¦ } }]\n */\n\nconst dateStr = new Date().toLocaleDateString('ko-KR', {\n  year: 'numeric', month: 'long', day: 'numeric',\n});\n\n/* ê³µí†µ ìŠ¤íƒ€ì¼ */\nconst WRAPPER_STYLE = `\n  width:100%;max-width:600px;border:1px solid #d9d9d9;border-radius:8px;\n  font-family:Arial,Helvetica,sans-serif;\n`;\n\n/* ë¯¸ë¦¬ë³´ê¸° ë¸”ë¡ */\nconst previewTitles = items.slice(0, 5)\n  .map((item, idx) => `${idx + 1}. ${item.json.title}`)\n  .join('<br/>');\n\nconst previewHtml = `\n  <table role=\"presentation\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"width:100%;margin:0 auto 32px;\">\n    <tr><td align=\"center\">\n      <table role=\"presentation\" cellpadding=\"0\" cellspacing=\"0\" style=\"${WRAPPER_STYLE}\">\n        <tr><td style=\"padding:24px;\">\n          <h2 style=\"margin:0 0 16px;font-size:24px;font-weight:bold;color:#61ba7a;\">${dateStr} AI ì£¼ìš” ì†Œì‹ TOP 5</h2>\n          <p style=\"font-size:16px;line-height:1.6;color:#111;margin:0;\">${previewTitles}</p>\n        </td></tr>\n      </table>\n    </td></tr>\n  </table>\n`;\n\n/* ê¸°ì‚¬ ì¹´ë“œ (í”¼ë“œë°± ì œê±°) */\nconst cardsHtml = items.slice(0, 10).map(item => {\n  const a = item.json;\n\n  const rankLabel = a.rank\n    ? `<p style=\"font-size:14px;color:#61ba7a;margin:0 0 4px;font-weight:bold;\">AI ê´€ë ¨ë„ ${a.rank}ìœ„</p>`\n    : '';\n\n  const reasonBlock = a.reason\n    ? `<div style=\"background:#f5f5f5;padding:12px;border-radius:6px;margin:0 0 16px;\">\n         <p style=\"font-size:14px;color:#666;margin:0;font-style:italic;\">\n           ğŸ’¡ ì„ ì • ì´ìœ : ${a.reason}\n         </p>\n       </div>`\n    : '';\n\n  const body = a.description\n    ? `<p style=\"font-size:16px;line-height:1.6;margin:0 0 18px;color:#333;\">\n         ${a.description.substring(0, 200)}${a.description.length > 200 ? '...' : ''}\n       </p>`\n    : '';\n\n  const pubDateLabel = a.pubDate\n    ? `<p style=\"font-size:13px;color:#999;margin:0 0 12px;\">\n         ğŸ“… ${new Date(a.pubDate).toLocaleDateString('ko-KR', {\n           year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit'\n         })}\n       </p>`\n    : '';\n\n  return `\n    <table role=\"presentation\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"width:100%;margin:0 auto 32px;\">\n      <tr><td align=\"center\">\n        <table role=\"presentation\" cellpadding=\"0\" cellspacing=\"0\" style=\"${WRAPPER_STYLE}\">\n          <tr><td style=\"padding:24px;\">\n\n            ${rankLabel}\n\n            <h2 style=\"margin:0 0 16px;font-size:22px;line-height:1.3;\">\n              <a href=\"${a.link || a.url}\" style=\"color:#61ba7a;text-decoration:none;\">${a.title}</a>\n            </h2>\n\n            ${pubDateLabel}\n            ${reasonBlock}\n            ${body}\n\n            <a href=\"${a.link || a.url}\" style=\"color:#61ba7a;font-size:16px;font-weight:bold;text-decoration:none;\">\n              ìì„¸íˆ ë³´ê¸° â†’\n            </a>\n\n          </td></tr>\n        </table>\n      </td></tr>\n    </table>\n  `;\n}).join('');\n\n/* ê²°ê³¼ ë°˜í™˜ */\nreturn [{ json: { htmlBlocks: previewHtml + cardsHtml } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1580,
        100
      ],
      "id": "828c193a-8d23-4950-8c5b-fb9d1ed70c2f",
      "name": "News Block HTML"
    },
    {
      "parameters": {
        "content": "## Web ì—°ê²° \n",
        "height": 260,
        "width": 180
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        0,
        0
      ],
      "id": "e6a73b51-11e7-4649-9b72-350d64af5e38",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "jsCode": "/**\n * n8n Code node\n * INPUT  : ì„ì—¬-ìˆëŠ”  items  ( â‘  rankÂ·reason ì „ìš© â‘¡ linkÂ·pubDateÂ·description ì „ìš© )\n * OUTPUT : ë‘ ì •ë³´ë¥¼ í•©ì³ ì™„ì „í•œ ë‹¨ì¼ JSON ë°°ì—´\n *          {title, link, pubDate, description, rank, reason}\n */\n\nconst THRESHOLD = 0.45;  // ì œëª© ìœ ì‚¬ë„ ì„ê³„ê°’(0~1)â€•ë‚®ì¶œìˆ˜ë¡ ê´€ëŒ€í•œ ë³‘í•©\n\n/* ìœ ì‚¬ë„: ê³µë°±Â·êµ¬ë‘ì  ì œê±° í›„ Jaccard */\nfunction similarity(a, b) {\n  const clean = s => s.toLowerCase().replace(/[^\\p{L}\\p{N}\\s]/gu,'');\n  const A = new Set(clean(a).split(/\\s+/));\n  const B = new Set(clean(b).split(/\\s+/));\n  const inter = [...A].filter(x => B.has(x)).length;\n  return inter / (A.size + B.size - inter || 1);\n}\n\n/* ëˆ„ì  Map  titleKey â†’ ê°ì²´ */\nconst merged = [];\n\nfor (const { json } of items) {\n  const cur = { ...json };                       // ë³µì‚¬\n  const title = cur.title?.trim();\n  if (!title) continue;\n\n  // ê°€ì¥ ìœ ì‚¬í•œ ê¸°ì‚¬ ì°¾ê¸°\n  let bestIdx = -1, bestScore = 0;\n  merged.forEach((m, idx) => {\n    const s = similarity(title, m.title);\n    if (s > bestScore) { bestScore = s; bestIdx = idx; }\n  });\n\n  /* ìƒˆ ê·¸ë£¹ */\n  if (bestScore < THRESHOLD) {\n    merged.push(cur);\n    continue;\n  }\n\n  /* ë³‘í•© â€“ ë¹ˆ í•„ë“œëŠ” ì±„ì›Œ ë„£ê¸° */\n  const target = merged[bestIdx];\n  for (const k of ['link','pubDate','description','rank','reason']) {\n    if (target[k] === undefined || target[k] === null) target[k] = cur[k];\n  }\n}\n\n/* ì •ë ¬: rank ìˆëŠ” ê±´ ì˜¤ë¦„ì°¨ìˆœ, ì—†ìœ¼ë©´ ë’¤ë¡œ */\nmerged.sort((a,b)=> (a.rank??999) - (b.rank??999));\n\nreturn merged.map(j => ({ json: j }));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1280,
        100
      ],
      "id": "5abe1589-b230-4431-a325-8c0724895f59",
      "name": "ë­í‚¹ + ê¸°ì¡´ ë°ì´í„° í†µí•©"
    },
    {
      "parameters": {
        "jsCode": "/******************************************************************\n * n8n Code node   â€”   HyperCLOVA-X ë‰´ìŠ¤ ë­í‚¹ íŒŒì„œ (Edge-case safe)\n * ì…ë ¥ : $json.choices[0].text (ì„ì˜ í˜•ì‹, <|im_end|> í¬í•¨)\n * ì¶œë ¥ : [{json:{rank,title,reason}}]  â€” rank ì˜¤ë¦„ì°¨ìˆœ\n ******************************************************************/\n\nconst raw = $json.choices?.[0]?.text ?? '';\nconst body = raw.split('<|')[0];                 // ë©”íƒ€ í† í° ì œê±°\n\n/*---------------------------------------------------------------\n  STEP-1  ìˆœìˆ˜ JSON ì°¾ê¸°   {...\"rankings\":[ {...}, ... ]}\n----------------------------------------------------------------*/\ntry {\n  const firstBrace = body.indexOf('{');\n  if (firstBrace !== -1) {\n    // JSON.parse ì—ëŸ¬ ë°©ì§€ë¥¼ ìœ„í•´ ë§ˆì§€ë§‰ '}' ìœ„ì¹˜ê¹Œì§€ ìë¦„\n    const lastBrace = body.lastIndexOf('}');\n    if (lastBrace > firstBrace) {\n      const cleaned = body.slice(firstBrace, lastBrace + 1)\n                           .replace(/,\\s*}/g, '}')         // trailing comma\n                           .replace(/,\\s*]/g, ']');        // trailing comma\n      const obj = JSON.parse(cleaned);\n      if (Array.isArray(obj.rankings)) return obj.rankings\n        .map(({rank,title,reason}) => ({json:{rank,title,reason}}))\n        .sort((a,b)=>a.json.rank-b.json.rank);\n    }\n  }\n} catch (_) { /* ëšâ€”ë‹¤ìŒ ë‹¨ê³„ */ }\n\n/*---------------------------------------------------------------\n  STEP-2  ê°ì²´ ë¸”ë¡ ë‹¨ìœ„ íŒŒì‹±  { \"rank\":n, \"title\":\"...\", ... }\n----------------------------------------------------------------*/\nconst blockRegex = /\\{[^{}]*?\"rank\"\\s*:\\s*\\d+[^{}]*?\"reason\"\\s*:\\s*\"[^\"]+?\"[^{}]*?}/gs;\nconst blocks = [...body.matchAll(blockRegex)].map(m=>m[0]);\nconst results = [];\n\nfor (const blk of blocks) {\n  try {\n    const safe = blk.replace(/,\\s*}/g,'}').replace(/,\\s*]/g,']');\n    const {rank,title,reason} = JSON.parse(safe);\n    results.push({rank,title,reason});\n  } catch {/* skip */}\n}\nif (results.length) {\n  results.sort((a,b)=>a.rank-b.rank);\n  return results.map(r=>({json:r}));\n}\n\n/*---------------------------------------------------------------\n  STEP-3  1-ë¼ì¸ íŒ¨í„´ íŒŒì‹±  \"rank\": n , \"title\": \"...\", \"reason\": \"...\"\n----------------------------------------------------------------*/\nconst lineRegex = /\"rank\"\\s*:\\s*(\\d+)[\\s\\S]+?\"title\"\\s*:\\s*\"([^\"]+?)\"[\\s\\S]+?\"reason\"\\s*:\\s*\"([^\"]+?)\"/g;\nlet m; let autoRank = 1;\nwhile ((m=lineRegex.exec(body))!==null) {\n  results.push({\n    rank:   Number(m[1]) || autoRank++,\n    title:  m[2],\n    reason: m[3]\n  });\n}\nif (!results.length) throw new Error('ë­í‚¹ ì •ë³´ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');\n\nresults.sort((a,b)=>a.rank-b.rank);\n\n// ì œëª© ì¤‘ë³µ ì œê±°(ì²« ë²ˆì§¸ë§Œ ë‚¨ê¹€)\nconst seen = new Set();\nconst unique = results.filter(r=>{\n  if (seen.has(r.title)) return false;\n  seen.add(r.title); return true;\n});\n\nreturn unique.map(r=>({json:r}));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        980,
        100
      ],
      "id": "4fddcbe6-aeff-4be1-bd6f-f8e1a4fad052",
      "name": "ë°ì´í„° íŒŒì‹±"
    },
    {
      "parameters": {
        "jsCode": "/**\n * n8n Code node\n * ì…ë ¥: HTTP Request ë…¸ë“œê°€ ë°˜í™˜í•œ JSON\n * ëª©ì : items[] ë°°ì—´ì„ ê°œë³„ ì•„ì´í…œìœ¼ë¡œ ë¶„ë¦¬â€†+â€†íƒœê·¸ ì œê±°\n * ì¶œë ¥: [{json:{title, link, pubDate, description}}, â€¦]\n */\nconst raw = $json;                     // HTTP ë…¸ë“œì—ì„œ ë„˜ì–´ì˜¨ í•œ ë©ì–´ë¦¬\nconst list = raw.items ?? [];          // safety\n\nreturn list.map(i => ({\n  json: {\n    title:       i.title.replace(/<[^>]*>/g, ''),        // <b>íƒœê·¸ ì œê±°\n    link:        i.link,\n    pubDate:     i.pubDate,\n    description: i.description.replace(/<[^>]*>/g, '')\n  }\n}));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        520,
        100
      ],
      "id": "d6eddbec-f64e-4979-9784-daa8df0359fb",
      "name": "API í•„ìš” ë°ì´í„° ì „ì²˜ë¦¬"
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "title"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        680,
        100
      ],
      "id": "5f77a9c1-aa9e-4a27-92ac-afacb50477c7",
      "name": "ëª¨ë¸ ì…ë ¥ ì²˜ë¦¬ìš© Flatten"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "newsletter-dev",
        "responseMode": "lastNode",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Access-Control-Allow-Origin",
                "value": "*"
              },
              {
                "name": "Access-Control-Allow-Methods",
                "value": "POST, OPTIONS"
              },
              {
                "name": "Access-Control-Allow-Headers",
                "value": "Content-Type, Accept"
              }
            ]
          }
        }
      },
      "id": "99cbabe4-f779-48c9-97a5-3efffbedf148",
      "name": "Webhook íŠ¸ë¦¬ê±°",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        40,
        100
      ],
      "webhookId": "research-webhook"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1660,
        620
      ],
      "id": "f42f706c-4ed9-46c8-a982-c8b446201188",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        1420,
        540
      ],
      "id": "14020cf6-7bdb-4fd9-a47d-38157d3c1c13",
      "name": "Loop Over Items"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "name": "Replace Me",
      "typeVersion": 1,
      "position": [
        1920,
        620
      ],
      "id": "b7eec2bb-4ebc-4db3-ac0c-ccbcc3605a06"
    },
    {
      "parameters": {
        "maxItems": 5
      },
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        1420,
        100
      ],
      "id": "9418f437-b494-4b06-be55-b860637609a4",
      "name": "Limit"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1SdhFhHhdvdWy0eroyrzMNggMAeG5wzImoGCtye7JjXQ",
          "mode": "list",
          "cachedResultName": "newsletter",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1SdhFhHhdvdWy0eroyrzMNggMAeG5wzImoGCtye7JjXQ/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "info",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1SdhFhHhdvdWy0eroyrzMNggMAeG5wzImoGCtye7JjXQ/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "address": "={{ $node[\"query\"].json.address }}",
            "keyword": "={{ $node[\"query\"].json.query }}",
            "sorting": "={{ $node[\"query\"].json.sorting }}",
            "language": "={{ $node[\"query\"].json.language }}"
          },
          "matchingColumns": [
            "address"
          ],
          "schema": [
            {
              "id": "keyword",
              "displayName": "keyword",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "address",
              "displayName": "address",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "sorting",
              "displayName": "sorting",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "language",
              "displayName": "language",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        2120,
        100
      ],
      "id": "15c26584-ef4b-4a46-85c8-068e453dd01a",
      "name": "Google Sheets",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Eio1vCGLFfsdnqQZ",
          "name": "Google Sheets account - MJ "
        }
      }
    },
    {
      "parameters": {
        "content": "## ì •ë³´ ì €ì¥",
        "height": 260
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2060,
        0
      ],
      "id": "0d8048b2-876f-4e93-b48e-f1600fb0f24e",
      "name": "Sticky Note4"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        120,
        380
      ],
      "id": "b27d9ab8-aba5-473c-af78-3ccce810c94b",
      "name": "When clicking â€˜Execute workflowâ€™"
    }
  ],
  "pinData": {
    "query": [
      {
        "json": {
          "query": "ì¸ê³µì§€ëŠ¥",
          "address": "kangmj0825@gmail.com",
          "language": "ko",
          "sorting": "ì‹ ëª¨ë¸ ê°œë°œ"
        }
      }
    ]
  },
  "connections": {
    "ë„¤ì´ë²„ ë‰´ìŠ¤ ê²€ìƒ‰ (Naver API)": {
      "main": [
        [
          {
            "node": "API í•„ìš” ë°ì´í„° ì „ì²˜ë¦¬",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HCX ë‰´ìŠ¤ ê¸°ì‚¬ ë¦¬ë­í‚¹": {
      "main": [
        [
          {
            "node": "ë°ì´í„° íŒŒì‹±",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "ë­í‚¹ + ê¸°ì¡´ ë°ì´í„° í†µí•©",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "query": {
      "main": [
        [
          {
            "node": "ë„¤ì´ë²„ ë‰´ìŠ¤ ê²€ìƒ‰ (Naver API)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Header/Footer HTML4": {
      "main": [
        [
          {
            "node": "ì´ë©”ì¼ ë°œì†¡",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "News Block HTML": {
      "main": [
        [
          {
            "node": "Header/Footer HTML4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ë­í‚¹ + ê¸°ì¡´ ë°ì´í„° í†µí•©": {
      "main": [
        [
          {
            "node": "Limit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ë°ì´í„° íŒŒì‹±": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "API í•„ìš” ë°ì´í„° ì „ì²˜ë¦¬": {
      "main": [
        [
          {
            "node": "ëª¨ë¸ ì…ë ¥ ì²˜ë¦¬ìš© Flatten",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "ëª¨ë¸ ì…ë ¥ ì²˜ë¦¬ìš© Flatten": {
      "main": [
        [
          {
            "node": "HCX ë‰´ìŠ¤ ê¸°ì‚¬ ë¦¬ë­í‚¹",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ì´ë©”ì¼ ë°œì†¡": {
      "main": [
        [
          {
            "node": "Google Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit": {
      "main": [
        [
          {
            "node": "News Block HTML",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook íŠ¸ë¦¬ê±°": {
      "main": [
        [
          {
            "node": "query",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "60bf43f1-9fae-4dd0-9995-492196bfc624",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "5b40a9494f24c8b44272b9f4d7c9963f14b3c071b2bdbe4d4eb707fe6a8210b2"
  },
  "id": "rOpayPtLknuqel1H",
  "tags": []
}